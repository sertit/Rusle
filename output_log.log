ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1230, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1059, in produce_rusle
    tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 734, in raster_pre_processing
    raster_crop_path, raster_crop_arr, raster_crop_meta = crop_raster(aoi_path, raster_path, tmp_dir)
ValueError: not enough values to unpack (expected 3, got 2)

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1203, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1037, in produce_rusle
    tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 751, in raster_pre_processing
    out_dict[key] = raster_masked_path
UnboundLocalError: local variable 'raster_masked_path' referenced before assignment

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1232, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1059, in produce_rusle
    tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 748, in raster_pre_processing
    rasters.write(raster_masked_xarr, raster_path, nodata=0)
UnboundLocalError: local variable 'raster_masked_xarr' referenced before assignment

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1200, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1043, in produce_rusle
    dem_crop_xarr = rasters.crop(dem_path, aoi_gdf)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 143, in path_or_xarr_or_dst_wrapper
    out = function(xds, *args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 479, in crop
    return xds_new.rio.clip(shapes, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rioxarray\raster_array.py", line 723, in clip
    invert=invert,
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rioxarray\raster_array.py", line 172, in _clip_xarray
    all_touched=all_touched,
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\env.py", line 387, in wrapper
    return f(*args, **kwds)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\features.py", line 73, in geometry_mask
    default_value=mask_value).astype('bool')
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\env.py", line 384, in wrapper
    return f(*args, **kwds)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\features.py", line 356, in rasterize
    _rasterize(valid_shapes, out, transform, all_touched, merge_alg)
  File "rasterio\_features.pyx", line 352, in rasterio._features._rasterize
  File "rasterio\_io.pyx", line 1754, in rasterio._io.InMemoryRaster.__init__
  File "rasterio\_err.pyx", line 215, in rasterio._err.exc_wrap_pointer
rasterio._err.CPLE_OutOfMemoryError: memdataset.cpp, 1513: cannot allocate 1x48000000000 bytes

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1200, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1025, in produce_rusle
    tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 778, in raster_pre_processing
    raster_collocate_xarr = rasters.collocate(ref_xarr, raster_crop_xarr, resampling_method, from_disk=True)
TypeError: collocate() got an unexpected keyword argument 'from_disk'

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1200, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1025, in produce_rusle
    tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 781, in raster_pre_processing
    raster_masked_xarr = rasters.mask(raster_collocate_xarr, aoi_gdf, from_disk=True)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 107, in path_or_xarr_or_dst_wrapper
    out = function(path_or_ds, *args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 464, in mask
    arr, _ = rasters_rio.mask(xds, shapes=shapes, nodata=nodata, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters_rio.py", line 133, in path_or_arr_or_dst_wrapper
    out = function(dst, *args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters_rio.py", line 620, in mask
    return _mask(dst, shapes=shapes, nodata=nodata, do_crop=False, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters_rio.py", line 138, in path_or_arr_or_dst_wrapper
    out = function(path_or_arr_or_ds, *args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters_rio.py", line 567, in _mask
    msk, trf = rmask.mask(dst, shapes, nodata=nodata, crop=do_crop, **kwargs)
TypeError: mask() got an unexpected keyword argument 'from_disk'

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1200, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1049, in produce_rusle
    rasters.write(dem_reproj_xarr, ls_path, nodata=0)
UnboundLocalError: local variable 'ls_path' referenced before assignment

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1200, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1053, in produce_rusle
    ls_raw_xarr = produce_ls_factor(dem_reproj_path, tmp_dir)
TypeError: produce_ls_factor() missing 1 required positional argument: 'tmp_dir'

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1198, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1054, in produce_rusle
    ls_xarr = rasters.collocate(rasters.read(post_process_dict[0]), ls_raw_xarr, Resampling.bilinear)
KeyError: 0

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1198, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1054, in produce_rusle
    ls_xarr = rasters.collocate(rasters.read(post_process_dict[[0]]), ls_raw_xarr, Resampling.bilinear)
TypeError: unhashable type: 'list'

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1198, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1054, in produce_rusle
    ls_xarr = rasters.collocate(rasters.read(post_process_dict[post_process_dict.keys()[0]]), ls_raw_xarr, Resampling.bilinear)
TypeError: 'dict_keys' object is not subscriptable

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1060, in produce_rusle
    fcover_arr, meta_fcover = produce_fcover(red_process_path, nir_process_path, aoi_path, tmp_dir)
ValueError: not enough values to unpack (expected 2, got 1)

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1064, in produce_rusle
    rasters.write(fcover_arr, fcover_path, meta_fcover, nodata=0)
UnboundLocalError: local variable 'fcover_arr' referenced before assignment

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1095, in produce_rusle
    lulc_arr, lulc_meta = rasters.read(lulc_dst)
ValueError: not enough values to unpack (expected 2, got 1)

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1095, in produce_rusle
    lulc_arr, lulc_meta = rasters.read(lulc_dst)
ValueError: not enough values to unpack (expected 2, got 1)

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1060, in produce_rusle
    fcover_xarr = produce_fcover(red_process_path, nir_process_path, aoi_path, tmp_dir)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 291, in produce_fcover
    rasters.write(ndvi_crop_xarr, ndvi_crop_path, nodata=0)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 107, in path_or_xarr_or_dst_wrapper
    out = function(path_or_ds, *args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\sertit\rasters.py", line 646, in write
    xds.rio.to_raster(path, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rioxarray\raster_array.py", line 928, in to_raster
    **out_profile,
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rioxarray\raster_writer.py", line 152, in to_raster
    with rasterio.open(self.raster_path, "w", **kwargs) as rds:
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\env.py", line 435, in wrapper
    return f(*args, **kwds)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\rasterio\__init__.py", line 231, in open
    **kwargs)
  File "rasterio\_io.pyx", line 1114, in rasterio._io.DatasetWriterBase.__init__
  File "rasterio\_io.pyx", line 86, in rasterio._io._delete_dataset_if_exists
  File "rasterio\_err.pyx", line 192, in rasterio._err.exc_wrap_int
rasterio._err.CPLE_AppDefinedError: Deleting D:/TLedauphin/02_Temp_traitement/Test_rusle/EMSN073_output/temp_dir/ndvi_cropped.tif.ovr failed: Permission denied

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1193, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1100, in produce_rusle
    c_arr, c_meta = produce_c(lulc_arr, lulc_meta, fcover_arr, aoi_path, lulc_name)
UnboundLocalError: local variable 'lulc_arr' referenced before assignment

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1199, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1084, in produce_rusle
    lulc_del_xarr = update_raster(lulc_process_path, del_gdf, 334)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 322, in update_raster
    shp_gdf = gpd.read_file(shp_path)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\geopandas\io\file.py", line 160, in _read_file
    with reader(path_or_bytes, **kwargs) as features:
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\fiona\env.py", line 408, in wrapper
    return f(*args, **kwargs)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\fiona\__init__.py", line 256, in open
    path = parse_path(fp)
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\site-packages\fiona\path.py", line 129, in parse_path
    elif sys.platform == "win32" and re.match("^[a-zA-Z]\\:", path):
  File "C:\Users\tledauphin\.conda\envs\arcgispro-eo\lib\re.py", line 175, in match
    return _compile(pattern, flags).match(string)
TypeError: expected string or bytes-like object

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1199, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1084, in produce_rusle
    lulc_del_xarr = update_raster(lulc_process_path, shp_path, 334)
NameError: name 'shp_path' is not defined

ERROR    RUSLE has failed: Traceback (most recent call last):
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1199, in <module>
    produce_rusle(input_dict)
  File "D:/TLedauphin/01_Projets_en_cours/Development/RUSLE/rusle/rusle_arcgis_pro.py", line 1084, in produce_rusle
    lulc_del_xarr = rasters.mask(src, shp_gdf, invert=True, nodata=334)
NameError: name 'src' is not defined

